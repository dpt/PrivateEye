Building PrivateEye
===================

Prerequisities
--------------

 - Acorn/Castle C/C++
 
I use the latest(?) ROOL version which includes Norcroft C version 5.68 [25
Jun 2009]. Older versions will need the -memaccess switches if you're hoping
to build a BeagleBoard compatible version.

I've used GCC to build with in the past, but there's nothing in the source to
assist with that at the moment.

 - OSLib

http://ro-oslib.sourceforge.net/

You'll need the trunk version as the most recent stable release, 6.9 is a
bit old and crusty now.

 - Makatic3
 
Automatic makefile builder. This might be tricky to find. Ask me for a copy.

Checking out
------------

Create a new directory <eyesrc> for the project. Then make it the CSD:

  *CDir <eyesrc>
  *Dir <eyesrc>

Set up SVN. I have the following in an Obey file called SetUpSVN and run it
before issuing any SVN commands:

  | Set up SVN to use file type extensions
  | e.g. An Obey file 'foo' will become 'foo,feb' in the repository.
  |
  Set svn$filetypeext Yes
  
  | Set extension names which will be reversed for RISC OS layout
  |
  Set UnixEnv$svn$sfix a:c:cc:cpp:errnum:f:h:Hdr:hdr:i:ii:l:msg:o:p:py:s:y

Check out the trunk:

  *svn co svn://svn.riscos.info/privateeye/trunk/

Building the beast
------------------

PrivateEye is itself built of two parts:

 (1) 'appengine'  - generic library code
 (2) '!PrivatEye' - application-specific logic

It also has dependencies on a number of third party libraries, including
libjpeg, libpng, zlib and exiftags. These are included in the source tree.

Library files are located relative to CLibs$Path. You should set CLibs$Path
to point to '<eyesrc>.trunk.libs.' You should also set CLibs$Path to point
to '<eyesrc>.trunk.libs.zlib.' (as libpng refers to zlib headers as 'zlib.h'
rather than zlib/zlib.h). e.g.

  *Path CLibs <eyesrc>.trunk.libs.,<eyesrc>.trunk.libs.zlib.

First we build the libraries which use Makatic3 to automatically create
their Makefiles as it's the same procedure for each.

For appengine, exiftags and md5:

  *Dir <eyesrc>.trunk.libs.<appengine/exiftags/...>
  *MakeMake    -- build the Makefile using Makatic
  *amu normal  -- build the normal library (as opposed to the debug version)
  
When complete you'll be presented with a library in the 'o' directory.


Second we build the libraries which have pre-made Makefiles:

For jpeg, png, zlib, fortify:

  *Dir <eyesrc>.trunk.libs.<jpeg/png/zlib/fortify>
  *CDir o             -- create the output directory
  *amu -f MakefileRO  -- build using the RISC OS Makefile

For libjpeg we also do:

  *CDir odf
  *amu -f MakefileRO libs  -- build libjpeg's libtrans

[This does some needless building of debug code - must fix].


Once the above libraries are built we can build appengine's test harness.
This gives us some guarantees that things are working properly.

  *Dir <eyesrc>.trunk.libs.appengine
  *amu test

This builds a DebugAIF binary (which when run, runs in DDT) which holds
appengine's unit tests. Set its type to Absolute if you don't want the
debugger popping up.

Run it with the output directed to a file:

  *aetest > output

You can compare the output with that in appengine.test.main.output (ie. diff
the two and see if anything's changed). You should see "Tests completed:
14/14 tests passed." at the end of the output if all is okay.


Now we can build PrivateEye itself.

  *Dir <eyesrc>.trunk.apps.!PrivatEye
  *MakeMake
  *amu normal


Once built, you can run !PrivatEye.


David Thomas
dave@davespace.co.uk
03-Oct-10
